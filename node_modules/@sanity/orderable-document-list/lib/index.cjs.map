{"version":3,"file":"index.cjs","sources":["../src/helpers/constants.ts","../src/helpers/parseOrderRank.ts","../src/helpers/initialRank.ts","../src/fields/orderRankField.ts","../src/fields/orderRankOrdering.ts","../src/OrderableContext.ts","../src/Document.tsx","../src/helpers/reorderDocuments.ts","../src/helpers/client.ts","../src/DraggableList.tsx","../src/helpers/query.ts","../src/helpers/getFilteredDedupedDocs.ts","../src/DocumentListQuery.tsx","../src/DocumentListWrapper.tsx","../src/helpers/resetOrder.ts","../src/OrderableDocumentList.tsx","../src/desk-structure/orderableDocumentListDeskItem.ts"],"sourcesContent":["export const ORDER_FIELD_NAME = `orderRank` as const\n\n// same version we are using in the vision plugin\nexport const API_VERSION = `v2025-06-27` as const\n","import {LexoRank} from 'lexorank'\n\n// Safely parse a LexoRank string; fall back if invalid\nexport function parseOrderRank(value: unknown, fallback: LexoRank): LexoRank {\n  if (typeof value !== 'string') {\n    console.warn('[orderable-document-list] Invalid orderRank value (expected string):', value)\n    return fallback\n  }\n\n  try {\n    return LexoRank.parse(value)\n  } catch (err) {\n    console.warn(\n      '[orderable-document-list] Failed to parse orderRank value:',\n      value,\n      'Error:',\n      err instanceof Error ? err.message : String(err),\n    )\n    return fallback\n  }\n}\n","import {LexoRank} from 'lexorank'\nimport {NewItemPosition} from '../types'\nimport {parseOrderRank} from './parseOrderRank'\n\n// Use in initial value field by passing in the rank value of the last document\n// If not value passed, generate a sensibly low rank\nexport function initialRank(\n  compareRankValue = ``,\n  newItemPosition: NewItemPosition = 'after',\n): string {\n  const compareRank = parseOrderRank(compareRankValue, LexoRank.min())\n  const rank =\n    newItemPosition === 'before' ? compareRank.genPrev().genPrev() : compareRank.genNext().genNext()\n\n  return rank.toString()\n}\n","import {type ConfigContext, defineField, FieldDefinition, type StringDefinition} from 'sanity'\nimport {API_VERSION, ORDER_FIELD_NAME} from '../helpers/constants'\nimport {initialRank} from '../helpers/initialRank'\nimport type {NewItemPosition} from '../types'\n\nexport type SchemaContext = Omit<ConfigContext, 'schema' | 'currentUser' | 'client'>\n\nexport interface RankFieldConfig\n  extends Partial<Omit<StringDefinition, 'name' | 'type' | 'initialValue'>> {\n  type: string\n  newItemPosition?: NewItemPosition\n}\n\nexport const orderRankField = (config: RankFieldConfig): FieldDefinition<'string'> => {\n  if (!config?.type) {\n    throw new Error(\n      `\n      type must be provided.\n      Example: orderRankField({type: 'category'})\n      `,\n    )\n  }\n\n  const {type, newItemPosition = 'after', ...rest} = config\n  return defineField({\n    title: 'Order Rank',\n    readOnly: true,\n    hidden: true,\n    ...rest,\n    name: ORDER_FIELD_NAME,\n    type: 'string',\n    initialValue: async (p, {getClient}) => {\n      const direction = newItemPosition === 'before' ? 'asc' : 'desc'\n\n      const lastDocOrderRank = await getClient({apiVersion: API_VERSION}).fetch(\n        `*[_type == $type]|order(@[$order] ${direction})[0][$order]`,\n        {type, order: ORDER_FIELD_NAME},\n        {tag: 'orderable-document-list.last-doc-order-rank'},\n      )\n      return initialRank(lastDocOrderRank, newItemPosition)\n    },\n  })\n}\n","import type {SortOrdering} from 'sanity'\nimport {ORDER_FIELD_NAME} from '../helpers/constants'\n\nexport const orderRankOrdering: SortOrdering = {\n  title: 'Ordered',\n  name: 'ordered',\n  by: [{field: ORDER_FIELD_NAME, direction: 'asc'}],\n}\n","import {createContext} from 'react'\n\nexport interface OrderableContextValue {\n  showIncrements?: boolean\n}\n\nexport const OrderableContext = createContext<OrderableContextValue>({})\n","import {useContext, useMemo, type ReactNode} from 'react'\nimport {ChevronDownIcon, ChevronUpIcon, DragHandleIcon} from '@sanity/icons'\nimport {AvatarCounter, Card, Box, Button, Flex, Text, Tooltip} from '@sanity/ui'\nimport {\n  useSchema,\n  SchemaType,\n  PreviewCard,\n  Preview,\n  DocumentStatusIndicator,\n  DocumentStatus,\n  useDocumentVersionInfo,\n} from 'sanity'\nimport {usePaneRouter} from 'sanity/structure'\n\nimport {OrderableContext} from './OrderableContext'\nimport type {SanityDocumentWithOrder} from './types'\n\nexport interface DocumentProps {\n  doc: SanityDocumentWithOrder\n  entities: SanityDocumentWithOrder[]\n  increment: (\n    index: number,\n    nextIndex: number,\n    docId: string,\n    entities: SanityDocumentWithOrder[],\n  ) => void\n  index: number\n  isFirst: boolean\n  isLast: boolean\n  dragBadge: number | false\n}\n\nexport function Document({\n  doc,\n  increment,\n  entities,\n  index,\n  isFirst,\n  isLast,\n  dragBadge,\n}: DocumentProps) {\n  const {showIncrements} = useContext(OrderableContext)\n  const schema = useSchema()\n  const router = usePaneRouter()\n  const versionsInfo = useDocumentVersionInfo(doc._id)\n\n  const {ChildLink, groupIndex, routerPanesState} = router\n\n  const currentDoc = routerPanesState[groupIndex + 1]?.[0]?.id || false\n  const pressed = currentDoc === doc._id || currentDoc === doc._id.replace(`drafts.`, ``)\n  const selected = pressed && routerPanesState.length === groupIndex + 2\n\n  const Link = useMemo(\n    () =>\n      function LinkComponent(linkProps: {children: ReactNode}) {\n        return <ChildLink {...linkProps} childId={doc._id} />\n      },\n    [ChildLink, doc._id],\n  )\n\n  const tooltip = (\n    <DocumentStatus\n      draft={versionsInfo.draft}\n      published={versionsInfo.published}\n      versions={versionsInfo.versions}\n    />\n  )\n\n  return (\n    <PreviewCard\n      __unstable_focusRing\n      // @ts-expect-error\n      as={Link}\n      data-as=\"a\"\n      data-ui=\"PaneItem\"\n      radius={2}\n      pressed={pressed}\n      selected={selected}\n      sizing=\"border\"\n      tabIndex={-1}\n      tone=\"inherit\"\n      width=\"100%\"\n      flex={1}\n    >\n      <Flex align=\"center\">\n        <Box paddingX={2} style={{flexShrink: 0}}>\n          <Text size={2}>\n            <DragHandleIcon cursor=\"grab\" />\n          </Text>\n        </Box>\n        {showIncrements && (\n          <Flex style={{flexShrink: 0}} align=\"center\" gap={1} paddingRight={1}>\n            <Button\n              padding={2}\n              mode=\"ghost\"\n              // eslint-disable-next-line react/jsx-no-bind\n              onClick={() => increment(index, index + -1, doc._id, entities)}\n              disabled={isFirst}\n              icon={ChevronUpIcon}\n            />\n            <Button\n              padding={2}\n              mode=\"ghost\"\n              disabled={isLast}\n              // eslint-disable-next-line react/jsx-no-bind\n              onClick={() => increment(index, index + 1, doc._id, entities)}\n              icon={ChevronDownIcon}\n            />\n          </Flex>\n        )}\n        <Box style={{width: `100%`}}>\n          <Flex flex={1} align=\"center\" justify=\"space-between\" paddingRight={3}>\n            <Preview\n              layout=\"default\"\n              value={doc}\n              schemaType={schema.get(doc._type) as SchemaType}\n            />\n\n            <Tooltip content={tooltip} portal placement=\"right\" boundaryElement={null}>\n              <Flex align=\"center\" style={{flexShrink: 0}}>\n                <DocumentStatusIndicator\n                  draft={versionsInfo.draft}\n                  published={versionsInfo.published}\n                  versions={versionsInfo.versions}\n                />\n              </Flex>\n            </Tooltip>\n          </Flex>\n        </Box>\n        {dragBadge && (\n          <Card tone=\"default\" marginRight={4} radius={5}>\n            <AvatarCounter count={dragBadge} />\n          </Card>\n        )}\n      </Flex>\n    </PreviewCard>\n  )\n}\n","import {LexoRank} from 'lexorank'\nimport type {PatchOperations} from 'sanity'\n\nimport type {SanityDocumentWithOrder} from '../types'\nimport {ORDER_FIELD_NAME} from './constants'\nimport {parseOrderRank} from './parseOrderRank'\n\nexport interface MaifestArgs {\n  entities: SanityDocumentWithOrder[]\n  selectedItems: SanityDocumentWithOrder[]\n  isMovingUp: boolean\n  curIndex: number\n  nextIndex: number\n  prevIndex: number\n}\n\nexport interface ReorderArgs {\n  entities: SanityDocumentWithOrder[]\n  selectedIds: string[]\n  source: any\n  destination: any\n}\n\nexport interface ReorderReturn {\n  newOrder: SanityDocumentWithOrder[]\n  patches: [string, PatchOperations][]\n  message: any\n}\n\nfunction lexicographicalSort(a: SanityDocumentWithOrder, b: SanityDocumentWithOrder) {\n  if (!a[ORDER_FIELD_NAME] || !b[ORDER_FIELD_NAME]) {\n    return 0\n  } else if (a[ORDER_FIELD_NAME] < b[ORDER_FIELD_NAME]) {\n    return -1\n  } else if (a[ORDER_FIELD_NAME] > b[ORDER_FIELD_NAME]) {\n    return 1\n  }\n  return 0\n}\n\nexport const reorderDocuments = ({\n  entities,\n  selectedIds,\n  source,\n  destination,\n}: ReorderArgs): ReorderReturn => {\n  const startIndex = source.index\n  const endIndex = destination.index\n  const isMovingUp = startIndex > endIndex\n  const selectedItems = entities.filter((item) => selectedIds.includes(item._id))\n  const message = [\n    'Moved',\n    selectedItems.length === 1 ? '1 document' : `${selectedItems.length} documents`,\n    isMovingUp ? 'up' : 'down',\n    'from position',\n    `${startIndex + 1} to ${endIndex + 1}`,\n  ].join(' ')\n\n  const {all, selected} = entities.reduce<{\n    all: SanityDocumentWithOrder[]\n    selected: SanityDocumentWithOrder[]\n  }>(\n    (acc, cur, curIndex) => {\n      // Selected items get spread in below, so skip them here\n      if (selectedIds.includes(cur._id)) {\n        return {all: acc.all, selected: acc.selected}\n      }\n\n      // Drop selected items in\n      if (curIndex === endIndex) {\n        const prevIndex = curIndex - 1\n        const prevRank = parseOrderRank(entities[prevIndex]?.[ORDER_FIELD_NAME], LexoRank.min())\n\n        const curRank = parseOrderRank(entities[curIndex][ORDER_FIELD_NAME], LexoRank.min())\n\n        const nextIndex = curIndex + 1\n        const nextRank = parseOrderRank(entities[nextIndex]?.[ORDER_FIELD_NAME], LexoRank.max())\n\n        let betweenRank = isMovingUp ? prevRank.between(curRank) : curRank.between(nextRank)\n\n        // For each selected item, assign a new orderRank between now and next\n        for (let selectedIndex = 0; selectedIndex < selectedItems.length; selectedIndex += 1) {\n          selectedItems[selectedIndex][ORDER_FIELD_NAME] = betweenRank.toString()\n          betweenRank = isMovingUp ? betweenRank.between(curRank) : betweenRank.between(nextRank)\n        }\n\n        return {\n          // The `all` array gets sorted by order field later anyway\n          // so that this probably isn't necessary ¯\\_(ツ)_/¯\n          all: isMovingUp\n            ? [...acc.all, ...selectedItems, cur]\n            : [...acc.all, cur, ...selectedItems],\n          selected: selectedItems,\n        }\n      }\n\n      return {all: [...acc.all, cur], selected: acc.selected}\n    },\n    {all: [], selected: []},\n  )\n\n  const patches = selected.flatMap((doc) => {\n    const docPatches: [string, PatchOperations][] = [\n      [\n        doc._id,\n        {\n          set: {\n            [ORDER_FIELD_NAME]: doc[ORDER_FIELD_NAME],\n          },\n        },\n      ],\n    ]\n\n    // If it's a draft, we need to patch the published document as well\n    if (doc._id.startsWith('drafts.') && doc.hasPublished) {\n      docPatches.push([\n        doc._id.replace('drafts.', ''),\n        {\n          set: {\n            [ORDER_FIELD_NAME]: doc[ORDER_FIELD_NAME],\n          },\n        },\n      ])\n    }\n\n    return docPatches\n  })\n\n  // Safety-check to make sure everything is in order\n  const allSorted = all.sort(lexicographicalSort)\n\n  return {newOrder: allSorted, patches, message}\n}\n","import {type SanityClient, useClient, usePerspective} from 'sanity'\nimport {API_VERSION} from './constants'\n\nexport function useSanityClient(): SanityClient {\n  const {perspectiveStack} = usePerspective()\n\n  return useClient({apiVersion: API_VERSION}).withConfig({perspective: perspectiveStack})\n}\n","import {useEffect, useState, useMemo, useCallback, type CSSProperties} from 'react'\nimport {DragDropContext, Draggable, Droppable, type DropResult} from '@hello-pangea/dnd'\nimport {Box, Card, useToast} from '@sanity/ui'\nimport type {PatchOperations} from 'sanity'\nimport {usePaneRouter} from 'sanity/structure'\n\nimport {Document} from './Document'\nimport {reorderDocuments} from './helpers/reorderDocuments'\nimport {ORDER_FIELD_NAME} from './helpers/constants'\nimport {useSanityClient} from './helpers/client'\nimport type {SanityDocumentWithOrder} from './types'\n\ninterface ListSetting {\n  isDuplicate: boolean\n  isGhosting: boolean\n  isDragging: boolean\n  isSelected: boolean\n}\n\nexport interface DraggableListProps {\n  data: SanityDocumentWithOrder[]\n  listIsUpdating: boolean\n  setListIsUpdating: (val: boolean) => void\n}\n\nconst getItemStyle = (\n  draggableStyle: CSSProperties | undefined,\n  itemIsUpdating: boolean,\n): CSSProperties => ({\n  userSelect: 'none',\n  transition: 'opacity 500ms ease-in-out',\n  opacity: itemIsUpdating ? 0.2 : 1,\n  pointerEvents: itemIsUpdating ? 'none' : undefined,\n  ...draggableStyle,\n})\n\nconst cardTone = (settings: ListSetting) => {\n  const {isDuplicate, isGhosting, isDragging, isSelected} = settings\n\n  if (isGhosting) return 'transparent'\n  if (isDragging || isSelected) return 'primary'\n  if (isDuplicate) return 'caution'\n\n  return undefined\n}\n\nexport function DraggableList({data, listIsUpdating, setListIsUpdating}: DraggableListProps) {\n  const toast = useToast()\n  const router = usePaneRouter()\n  const {groupIndex, routerPanesState} = router\n\n  const currentDoc = routerPanesState[groupIndex + 1]?.[0]?.id || false\n\n  // Maintains local state order before transaction completes\n  const [orderedData, setOrderedData] = useState<SanityDocumentWithOrder[]>(data)\n\n  // Update local state when documents change from an outside source\n  useEffect(() => {\n    if (!listIsUpdating) setOrderedData(data)\n    /* eslint-disable-next-line react-hooks/exhaustive-deps */\n  }, [data])\n\n  const [draggingId, setDraggingId] = useState('')\n  const [selectedIds, setSelectedIds] = useState<string[]>(currentDoc ? [currentDoc] : [])\n\n  const clearSelected = useCallback(() => setSelectedIds([]), [setSelectedIds])\n\n  const handleSelect = useCallback(\n    (clickedId: string, index: number, nativeEvent: MouseEvent) => {\n      const isSelected = selectedIds.includes(clickedId)\n      const selectMultiple = nativeEvent.shiftKey\n      const isUsingWindows = navigator.appVersion.indexOf('Win') !== -1\n      const selectAdditional = isUsingWindows ? nativeEvent.ctrlKey : nativeEvent.metaKey\n\n      let updatedIds = []\n\n      // No modifier keys pressed during click:\n      // - update selected to just this one\n      // - open document\n      if (!selectMultiple && !selectAdditional) {\n        return setSelectedIds([clickedId])\n      }\n\n      // If shift key was held, prevent default to avoid new window opening\n      if (selectMultiple) {\n        nativeEvent.preventDefault()\n      }\n\n      // Shift key was held, add id's between last selected and this one\n      // ...before adding this one\n      if (selectMultiple && !isSelected) {\n        const lastSelectedId = selectedIds[selectedIds.length - 1]\n        const lastSelectedIndex = orderedData.findIndex((item) => item._id === lastSelectedId)\n\n        const firstSelected = index < lastSelectedIndex ? index : lastSelectedIndex\n        const lastSelected = index > lastSelectedIndex ? index : lastSelectedIndex\n\n        const betweenIds = orderedData\n          .filter((item, itemIndex) => itemIndex > firstSelected && itemIndex < lastSelected)\n          .map((item) => item._id)\n\n        updatedIds = [...selectedIds, ...betweenIds, clickedId]\n      } else if (isSelected) {\n        // Toggle off a single id\n        updatedIds = selectedIds.filter((id) => id !== clickedId)\n      } else {\n        // Toggle on a single id\n        updatedIds = [...selectedIds, clickedId]\n      }\n\n      return setSelectedIds(updatedIds)\n    },\n    [setSelectedIds, orderedData, selectedIds],\n  )\n\n  const client = useSanityClient()\n\n  const transactPatches = useCallback(\n    async (patches: [string, PatchOperations][], message: string) => {\n      const transaction = client.transaction()\n\n      patches.forEach(([docId, ops]) => transaction.patch(docId, ops))\n\n      try {\n        const updated = await transaction.commit({\n          visibility: 'async',\n          tag: 'orderable-document-list.reorder',\n        })\n        clearSelected()\n        setDraggingId('')\n        setListIsUpdating(false)\n        toast.push({\n          title: `${\n            updated.results.length === 1 ? '1 document' : `${updated.results.length} documents`\n          } reordered`,\n          status: 'success',\n          description: message,\n        })\n      } catch (err) {\n        setDraggingId('')\n        setListIsUpdating(false)\n        toast.push({\n          title: 'Reordering failed',\n          status: 'error',\n        })\n      }\n    },\n    [client, setDraggingId, clearSelected, setListIsUpdating, toast],\n  )\n\n  const handleDragEnd = useCallback(\n    (result: DropResult | undefined, entities: SanityDocumentWithOrder[]) => {\n      setDraggingId('')\n\n      const {source, destination, draggableId} = result ?? {}\n\n      // Don't do anything if nothing changed\n      if (source?.index === destination?.index) return\n\n      // Don't do anything if we don't have the entitites\n      if (!entities?.length || !draggableId) return\n\n      // A document can be dragged without being one-of-many-selected\n      const effectedIds = selectedIds?.length ? selectedIds : [draggableId]\n\n      // Don't do anything if we don't have ids to effect\n      if (!effectedIds?.length) return\n\n      // Update state to update styles + prevent data refetching\n      setListIsUpdating(true)\n      setSelectedIds(effectedIds)\n\n      const {newOrder, patches, message} = reorderDocuments({\n        entities,\n        selectedIds: effectedIds,\n        source,\n        destination,\n      })\n\n      // Update local state\n      if (newOrder?.length) {\n        setOrderedData(newOrder)\n      }\n\n      // Transact new order patches\n      if (patches?.length) {\n        transactPatches(patches, message)\n      }\n    },\n    [selectedIds, setDraggingId, setSelectedIds, transactPatches, setListIsUpdating],\n  )\n\n  const handleDragStart = useCallback(\n    (start: {draggableId: string}) => {\n      const id = start.draggableId\n      const selected = selectedIds.includes(id)\n\n      // if dragging an item that is not selected - unselect all items\n      if (!selected) clearSelected()\n\n      setDraggingId(id)\n    },\n    [selectedIds, clearSelected, setDraggingId],\n  )\n\n  // Move one document up or down one place, by fake invoking the drag function\n  const incrementIndex = useCallback(\n    (shiftFrom: number, shiftTo: number, id: string, entities: SanityDocumentWithOrder[]) => {\n      const result = {\n        draggableId: id,\n        source: {index: shiftFrom},\n        destination: {index: shiftTo},\n      }\n\n      return handleDragEnd(result as DropResult, entities)\n    },\n    [handleDragEnd],\n  )\n\n  const onWindowKeyDown = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        clearSelected()\n      }\n    },\n    [clearSelected],\n  )\n\n  useEffect(() => {\n    window.addEventListener('keydown', onWindowKeyDown)\n\n    return () => {\n      window.removeEventListener('keydown', onWindowKeyDown)\n    }\n  }, [onWindowKeyDown])\n\n  // Find all items with duplicate order field\n  const duplicateOrders = useMemo(() => {\n    if (!orderedData.length) return []\n\n    const orderField = orderedData.map((item) => item[ORDER_FIELD_NAME])\n\n    return orderField.filter((item, index) => orderField.indexOf(item) !== index)\n  }, [orderedData])\n\n  const onDragEnd = useCallback(\n    (result: DropResult) => handleDragEnd(result, orderedData),\n    [orderedData, handleDragEnd],\n  )\n\n  return (\n    <DragDropContext onDragStart={handleDragStart} onDragEnd={onDragEnd}>\n      <Droppable droppableId=\"documentSortZone\">\n        {(provided) => (\n          <div {...provided.droppableProps} ref={provided.innerRef}>\n            {orderedData.map((item, index) => (\n              <Draggable\n                key={`${item._id}-${item[ORDER_FIELD_NAME]}`}\n                draggableId={item._id}\n                index={index}\n                // onClick={(event) => handleDraggableClick(event, provided, snapshot)}\n              >\n                {(innerProvided, innerSnapshot) => {\n                  const isSelected = selectedIds.includes(item._id)\n                  const isDragging = innerSnapshot.isDragging\n                  const isGhosting = Boolean(!isDragging && draggingId && isSelected)\n                  const isUpdating = listIsUpdating && isSelected\n                  const isDisabled = Boolean(!item[ORDER_FIELD_NAME])\n                  const isDuplicate = duplicateOrders.includes(item[ORDER_FIELD_NAME])\n                  const tone = cardTone({isDuplicate, isGhosting, isDragging, isSelected})\n                  const selectedCount = selectedIds.length\n\n                  const dragBadge = isDragging && selectedCount > 1 ? selectedCount : false\n\n                  return (\n                    <div\n                      ref={innerProvided.innerRef}\n                      {...innerProvided.draggableProps}\n                      {...innerProvided.dragHandleProps}\n                      style={\n                        isDisabled\n                          ? {opacity: 0.2, pointerEvents: 'none'}\n                          : getItemStyle(innerProvided.draggableProps.style, isUpdating)\n                      }\n                    >\n                      <Box paddingBottom={1}>\n                        <Card\n                          tone={tone}\n                          shadow={isDragging ? 2 : undefined}\n                          radius={2}\n                          // eslint-disable-next-line react/jsx-no-bind\n                          onClick={(e) => handleSelect(item._id, index, e.nativeEvent)}\n                        >\n                          <Document\n                            doc={item}\n                            entities={orderedData}\n                            increment={incrementIndex}\n                            index={index}\n                            isFirst={index === 0}\n                            isLast={index === orderedData.length - 1}\n                            dragBadge={dragBadge}\n                          />\n                        </Card>\n                      </Box>\n                    </div>\n                  )\n                }}\n              </Draggable>\n            ))}\n            {provided.placeholder}\n          </div>\n        )}\n      </Droppable>\n    </DragDropContext>\n  )\n}\n","import {ORDER_FIELD_NAME} from './constants'\n\nexport interface DocumentListQueryProps {\n  type: string\n  filter?: string\n  params?: Record<string, unknown>\n  currentVersion?: string\n}\n\nexport interface DocumentListQueryResult {\n  query: string\n  queryParams: Record<string, string | number | boolean | string[]>\n}\n\nconst DEFAULT_PARAMS = {}\n\nexport function getDocumentQuery({\n  type,\n  filter,\n  params = DEFAULT_PARAMS,\n  currentVersion,\n}: DocumentListQueryProps): DocumentListQueryResult {\n  let perspectiveFilter = null\n  if (currentVersion === 'published') {\n    perspectiveFilter = '!(_id in path(\"drafts.**\")) && !(_id in path(\"versions.**\"))'\n  } else if (currentVersion === 'drafts') {\n    // Show drafts, and published when no draft exists\n    perspectiveFilter = `\n      (_id in path(\"drafts.**\") || (!(_id in path(\"drafts.**\")) && !(_id in path(\"versions.**\"))))\n    `\n  } else {\n    // Default behavior: prioritize drafts over published when both exist\n    // the priority should be a version\n    perspectiveFilter = `(sanity::partOfRelease($currentVersion) || (!(_id in path(\"drafts.**\")) && !(_id in path(\"versions.**\"))) || (_id in path(\"drafts.**\")))`\n  }\n\n  const querySelect = `*[_type == $type ${perspectiveFilter ? `&& ${perspectiveFilter}` : ''}${filter ? `&& ${filter}` : ''}]`\n  const queryOrder = `|order(@[$order] asc)`\n  const queryFields = `{_id, _type, ${ORDER_FIELD_NAME}}`\n\n  const query = `${querySelect}${queryOrder}${queryFields}`\n  const queryParams = {\n    ...params,\n    type,\n    order: ORDER_FIELD_NAME,\n    ...(currentVersion && {currentVersion}),\n  }\n\n  return {query, queryParams}\n}\n","import {getPublishedId, getVersionFromId, isDraftId, isPublishedId, isVersionId} from 'sanity'\nimport {type SanityDocumentWithOrder} from '../types'\n\nconst isVersionForCurrentPerspective = (\n  document: SanityDocumentWithOrder,\n  perspectiveName: string,\n  publishedId: string,\n) => {\n  return (\n    document._id &&\n    isVersionId(document._id) &&\n    getVersionFromId(document._id) === perspectiveName &&\n    getPublishedId(document._id) === publishedId\n  )\n}\n\n// this removes dedupped docs from the list and makes sure that it keeps the right docs\n// in the list while preserving the order established by the orderRank field\nexport const getFilteredDedupedDocs = (\n  documents: SanityDocumentWithOrder[],\n  perspectiveName?: string,\n): SanityDocumentWithOrder[] => {\n  // Flatten the documents array in case it's nested (like in test data)\n  const flatDocuments = documents.flat()\n\n  return flatDocuments.reduce<SanityDocumentWithOrder[]>((acc, cur) => {\n    if (!cur._id) {\n      return acc\n    }\n\n    // Handle version-only documents\n    if (isVersionId(cur._id)) {\n      const versionFromId = getVersionFromId(cur._id)\n      const isCorrectVersion = versionFromId === perspectiveName\n\n      // Only include versions that match the current perspective\n      if (\n        perspectiveName &&\n        perspectiveName !== 'drafts' &&\n        perspectiveName !== 'published' &&\n        isCorrectVersion\n      ) {\n        return [...acc, cur]\n      }\n      return acc\n    }\n\n    // Handle published perspective - only include published documents\n    if (perspectiveName === 'published') {\n      if (isPublishedId(cur._id)) {\n        return [...acc, cur]\n      }\n      return acc\n    }\n\n    // in situations where the document is not a draft, we need to check if\n    // the version should override a published document or a draft\n    if (!isDraftId(cur._id)) {\n      const publishedId = getPublishedId(cur._id)\n\n      const countNrPublished = JSON.stringify(flatDocuments).match(`/${publishedId}/g`)\n\n      // Check if there's a version that matches the perspectiveName\n      const hasMatchingVersion =\n        perspectiveName && perspectiveName !== 'drafts' && perspectiveName !== 'published'\n          ? flatDocuments.some((doc) =>\n              isVersionForCurrentPerspective(doc, perspectiveName, publishedId),\n            )\n          : false\n\n      // Check if there's a draft\n      const hasDraft = flatDocuments.some((doc) => doc._id === `drafts.${cur._id}`)\n\n      // Priority: version > draft > published\n      // If there's a matching version, skip published\n      if (hasMatchingVersion) {\n        return acc\n      }\n\n      // eslint-disable-next-line max-nested-callbacks\n      const alsoHasDraft = hasDraft || countNrPublished\n      return alsoHasDraft ? acc : [...acc, cur]\n    }\n\n    // For drafts, check if there's a version for this document in version perspective\n    if (perspectiveName && perspectiveName !== 'drafts' && perspectiveName !== 'published') {\n      const baseId = getPublishedId(cur._id)\n      const hasVersion = flatDocuments.some((doc) =>\n        isVersionForCurrentPerspective(doc, perspectiveName, baseId),\n      )\n\n      // If there's a version for this document, skip the draft\n      if (hasVersion) {\n        return acc\n      }\n    }\n\n    // Check if the draft has a published version\n    cur.hasPublished = flatDocuments.some((doc) => doc._id === cur._id.replace(`drafts.`, ``))\n\n    return [...acc, cur]\n  }, [])\n}\n","import {useEffect, useMemo, useState} from 'react'\nimport {Box, Flex, Container, Spinner, Stack, Text} from '@sanity/ui'\n\nimport {useListeningQuery, Feedback} from 'sanity-plugin-utils'\nimport {DraggableList} from './DraggableList'\nimport {ORDER_FIELD_NAME} from './helpers/constants'\nimport type {SanityDocumentWithOrder} from './types'\nimport {DocumentListQueryProps, getDocumentQuery} from './helpers/query'\nimport {getFilteredDedupedDocs} from './helpers/getFilteredDedupedDocs'\n\nexport function DocumentListQuery(props: DocumentListQueryProps) {\n  const [listIsUpdating, setListIsUpdating] = useState(false)\n  const [data, setData] = useState<SanityDocumentWithOrder[] | null>([])\n\n  const {query, queryParams} = getDocumentQuery(props)\n\n  const {\n    data: _queryData,\n    loading,\n    error,\n  } = useListeningQuery<SanityDocumentWithOrder[]>(query, {\n    params: queryParams,\n    initialValue: [],\n  })\n  // @ts-expect-error Should not be needed to \"cast\", but sanity-plugin-utils is not typed correctly\n  const queryData: SanityDocumentWithOrder[] = _queryData\n\n  useEffect(() => {\n    if (queryData) {\n      const filteredDocuments = getFilteredDedupedDocs(queryData, props.currentVersion)\n      setData(filteredDocuments)\n    } else {\n      setData([])\n    }\n  }, [queryData])\n\n  const unorderedDataCount = useMemo(\n    () => (data?.length ? data.filter((doc) => !doc[ORDER_FIELD_NAME]).length : 0),\n    [data],\n  )\n\n  if (loading) {\n    return (\n      <Flex style={{width: `100%`, height: `100%`}} align=\"center\" justify=\"center\">\n        <Spinner />\n      </Flex>\n    )\n  }\n\n  if (error) {\n    return (\n      <Box padding={2}>\n        <Feedback tone=\"critical\" title=\"There was an error\" description=\"Please try again later\" />\n      </Box>\n    )\n  }\n\n  if (!data || data?.length == 0)\n    return (\n      <Flex align=\"center\" direction=\"column\" height=\"fill\" justify=\"center\">\n        <Container width={1}>\n          <Box paddingX={4} paddingY={5}>\n            <Text align=\"center\" muted>\n              No documents of this type\n            </Text>\n          </Box>\n        </Container>\n      </Flex>\n    )\n\n  return (\n    <Stack space={1} style={{overflow: `auto`, height: `100%`}}>\n      <Box padding={2}>\n        {unorderedDataCount > 0 && (\n          <Box marginBottom={2}>\n            <Feedback\n              tone=\"caution\"\n              description={\n                <>\n                  {unorderedDataCount}/{data?.length} documents have no order. Select{' '}\n                  <strong>Reset Order</strong> from the menu above to fix.\n                </>\n              }\n            />\n          </Box>\n        )}\n        <DraggableList\n          data={data}\n          listIsUpdating={listIsUpdating}\n          setListIsUpdating={setListIsUpdating}\n        />\n      </Box>\n    </Stack>\n  )\n}\n","import {useEffect, useMemo} from 'react'\nimport {useToast, Box, type ToastParams} from '@sanity/ui'\n\nimport {useSchema} from 'sanity'\nimport {Feedback} from 'sanity-plugin-utils'\nimport {DocumentListQuery} from './DocumentListQuery'\nimport {OrderableContext} from './OrderableContext'\n\nimport {ORDER_FIELD_NAME} from './helpers/constants'\n\nexport interface DocumentListWrapperProps {\n  showIncrements: boolean\n  type: string\n  resetOrderTransaction: ToastParams\n  // eslint-disable-next-line react/require-default-props\n  filter?: string\n  // eslint-disable-next-line react/require-default-props\n  params?: Record<string, unknown>\n  // eslint-disable-next-line react/require-default-props\n  currentVersion?: string\n}\n\n// 1. Validate first that the schema has been configured for ordering\n// 2. Setup context for showIncrements\nexport function DocumentListWrapper({\n  type,\n  showIncrements,\n  resetOrderTransaction,\n  filter,\n  params,\n  currentVersion,\n}: DocumentListWrapperProps) {\n  const toast = useToast()\n  const schema = useSchema()\n\n  useEffect(() => {\n    if (resetOrderTransaction?.title && resetOrderTransaction?.status) {\n      toast.push(resetOrderTransaction)\n    }\n  }, [resetOrderTransaction, toast])\n\n  const schemaIsInvalid = useMemo(() => {\n    // Option not passed\n    if (!type) {\n      return (\n        <>\n          No <code>type</code> was configured\n        </>\n      )\n    }\n\n    const typeSchema = schema.get(type)\n\n    // Schema not found\n    if (!typeSchema) {\n      return (\n        <>\n          Schema <code>{type}</code> not found\n        </>\n      )\n    }\n\n    // Schema lacks an order field\n    if (\n      !('fields' in typeSchema) ||\n      !typeSchema.fields.some((field) => field?.name === ORDER_FIELD_NAME)\n    ) {\n      return (\n        <>\n          Schema <code>{type}</code> must have an <code>{ORDER_FIELD_NAME}</code> field of type{' '}\n          <code>string</code>\n        </>\n      )\n    }\n\n    // Schema's order field is not a string\n    if (\n      'fields' in typeSchema &&\n      typeSchema.fields.some(\n        (field) => field?.name === ORDER_FIELD_NAME && field?.type?.name !== 'string',\n      )\n    ) {\n      return (\n        <>\n          <code>{ORDER_FIELD_NAME}</code> field on Schema <code>{type}</code> must be{' '}\n          <code>string</code> type\n        </>\n      )\n    }\n\n    return ''\n  }, [type, schema])\n\n  if (schemaIsInvalid) {\n    return (\n      <Box padding={2}>\n        <Feedback description={schemaIsInvalid} tone=\"caution\" />\n      </Box>\n    )\n  }\n\n  return (\n    <OrderableContext.Provider value={{showIncrements}}>\n      <DocumentListQuery\n        type={type}\n        filter={filter}\n        params={params}\n        currentVersion={currentVersion}\n      />\n    </OrderableContext.Provider>\n  )\n}\n","import {LexoRank} from 'lexorank'\nimport type {MultipleMutationResult, SanityClient} from '@sanity/client'\nimport {ORDER_FIELD_NAME} from './constants'\nimport {DocumentListQueryProps, getDocumentQuery} from './query'\n\nexport interface ResetOrderParams extends DocumentListQueryProps {\n  client: SanityClient\n  currentVersion?: string\n}\n\n// Function to wipe and re-do ordering with LexoRank\n// Will at least attempt to start with the current order\nexport async function resetOrder(params: ResetOrderParams): Promise<MultipleMutationResult | null> {\n  const {client, currentVersion, ...queryProps} = params\n  const {query, queryParams} = getDocumentQuery({...queryProps, currentVersion})\n\n  const documents = await client.fetch<\n    Array<{\n      _id: string\n      _type: string\n      [ORDER_FIELD_NAME]: string\n    }>\n  >(query, queryParams, {\n    tag: 'orderable-document-list.reset-order',\n  })\n\n  if (documents.length === 0) {\n    return null\n  }\n\n  let aLexoRank = LexoRank.min()\n\n  const transaction = documents\n    .map((doc) => doc._id)\n    .reduce((trx, documentId) => {\n      // Generate next rank before even the first document so there's room to move!\n      aLexoRank = aLexoRank.genNext().genNext()\n\n      return trx.patch(documentId, {\n        set: {[ORDER_FIELD_NAME]: aLexoRank.toString()},\n      })\n    }, client.transaction())\n\n  return transaction.commit({\n    visibility: 'async',\n    tag: 'orderable-document-list.reset-order',\n  })\n}\n","import {Component} from 'react'\n\nimport type {SanityClient} from '@sanity/client'\nimport type {ToastParams} from '@sanity/ui'\nimport {DocumentListWrapper} from './DocumentListWrapper'\nimport {resetOrder} from './helpers/resetOrder'\n\nexport interface OrderableDocumentListProps {\n  options: {\n    type: string\n    client: SanityClient\n    filter?: string\n    params?: Record<string, unknown>\n    currentVersion?: string\n  }\n}\n\ninterface State {\n  showIncrements: boolean\n  resetOrderTransaction: ToastParams\n}\n\n// Must use a Class Component here so the actionHandlers can be called\nexport class OrderableDocumentList extends Component<OrderableDocumentListProps, State> {\n  constructor(props: OrderableDocumentListProps) {\n    super(props)\n    this.state = {\n      showIncrements: false,\n      resetOrderTransaction: {},\n    }\n  }\n\n  actionHandlers = {\n    showIncrements: () => {\n      this.setState((state) => ({\n        showIncrements: !state.showIncrements,\n      }))\n    },\n\n    resetOrder: async () => {\n      this.setState(() => ({\n        resetOrderTransaction: {\n          status: `info`,\n          title: `Reordering started...`,\n          closable: true,\n        },\n      }))\n\n      const update = await resetOrder(this.props.options)\n\n      const reorderWasSuccessful = update?.results?.length\n\n      this.setState(() => ({\n        resetOrderTransaction: {\n          status: reorderWasSuccessful ? `success` : `info`,\n          title: reorderWasSuccessful\n            ? `Reordered ${update.results.length === 1 ? `Document` : `Documents`}`\n            : `Reordering failed`,\n          closable: true,\n        },\n      }))\n    },\n  }\n\n  render() {\n    const type = this?.props?.options?.type\n    if (!type) {\n      return null\n    }\n    return (\n      <DocumentListWrapper\n        filter={this?.props?.options?.filter}\n        params={this?.props?.options?.params}\n        type={type}\n        showIncrements={this.state.showIncrements}\n        resetOrderTransaction={this.state.resetOrderTransaction}\n        currentVersion={this?.props?.options?.currentVersion}\n      />\n    )\n  }\n}\n","import {GenerateIcon, SortIcon} from '@sanity/icons'\nimport type {ConfigContext} from 'sanity'\n\nimport type {ComponentType} from 'react'\nimport {StructureBuilder, type ListItem, type MenuItem} from 'sanity/structure'\nimport {OrderableDocumentList} from '../OrderableDocumentList'\nimport {API_VERSION} from '../helpers/constants'\n\nexport interface OrderableListConfig {\n  type: string\n  id?: string\n  title?: string\n  icon?: ComponentType\n  params?: Record<string, unknown>\n  filter?: string\n  menuItems?: MenuItem[]\n  createIntent?: boolean\n  context: ConfigContext\n  S: StructureBuilder\n}\n\nexport function orderableDocumentListDeskItem(config: OrderableListConfig): ListItem {\n  if (!config?.type || !config.context || !config.S) {\n    throw new Error(`\n    type, context and S (StructureBuilder) must be provided.\n    context and S are available when configuring structure.\n    Example: orderableDocumentListDeskItem({type: 'category'})\n    `)\n  }\n\n  const {type, filter, menuItems = [], createIntent, params, title, icon, id, context, S} = config\n  const {schema, getClient} = context\n  // 'perspectiveStack' may not exist on ConfigContext in some versions\n  const perspectiveStack = (context as any).perspectiveStack || []\n  const client = getClient({apiVersion: API_VERSION})\n  // the first position in the perspective stack is the current version\n  const currentVersion = perspectiveStack[0]\n\n  const listTitle = title ?? `Orderable ${type}`\n  const listId = id ?? `orderable-${type}`\n  const listIcon = icon ?? SortIcon\n  const typeTitle = schema.get(type)?.title ?? type\n\n  if (createIntent !== false) {\n    menuItems.push(\n      S.menuItem()\n        .title(`Create new ${typeTitle}`)\n        .intent({type: 'create', params: {type}})\n        .serialize(),\n    )\n  }\n  return S.listItem()\n    .title(listTitle)\n    .id(listId)\n    .icon(listIcon)\n    .schemaType(type)\n    .child(\n      Object.assign(\n        S.documentTypeList(type)\n          .canHandleIntent(() => !!createIntent)\n          .serialize(),\n        {\n          // Prevents the component from re-rendering when switching documents\n          __preserveInstance: true,\n          // Prevents the component from NOT re-rendering when switching listItems\n          key: listId,\n\n          type: 'component',\n          component: OrderableDocumentList,\n          options: {type, filter, params, client, currentVersion},\n          menuItems: [\n            ...menuItems,\n            S.menuItem().title(`Reset Order`).icon(GenerateIcon).action(`resetOrder`).serialize(),\n            S.menuItem()\n              .title(`Toggle Increments`)\n              .icon(SortIcon)\n              .action(`showIncrements`)\n              .serialize(),\n          ],\n        },\n      ),\n    )\n    .serialize()\n}\n"],"names":["LexoRank","defineField","createContext","useContext","useSchema","usePaneRouter","useDocumentVersionInfo","useMemo","jsx","DocumentStatus","PreviewCard","jsxs","Flex","Box","Text","DragHandleIcon","Button","ChevronUpIcon","ChevronDownIcon","Preview","Tooltip","DocumentStatusIndicator","Card","AvatarCounter","usePerspective","useClient","useToast","useState","useEffect","useCallback","DragDropContext","Droppable","Draggable","isVersionId","getVersionFromId","getPublishedId","isPublishedId","isDraftId","useListeningQuery","Spinner","Feedback","Container","Stack","Fragment","Component","SortIcon","GenerateIcon"],"mappings":"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"}